{% load static %}
{% include 'admin/components/header.html' %}
  {% include 'admin/components/sidebar.html' %}
  <style type="text/css">
    .modal {
        display: none; 
        position: fixed; 
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 38px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
  </style>
  <section class="section">
      <link rel="stylesheet" href="https://cdn.datatables.net/1.13.11/css/jquery.dataTables.min.css">
      <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
      <script src="https://cdn.datatables.net/1.13.11/js/jquery.dataTables.min.js"></script>
      <div class="section-header">
        <h1>Kelola Mobil</h1>
      </div>
      <button onClick="buttonTambah()" type="button" class="btn btn-primary">Tambah Mobil</button>
      <h2>Mobil List</h2>
      <table id="mobil" class="display">
          <thead>
              <tr>
                  <th>ID</th>
                  <th>Merek</th>
                  <th>Kapasitas</th>
                  <th>Durasi</th>
                  <th>Harga</th>
                  <th>Action</th>
              </tr>
          </thead>
          <tbody id="tbodymobil">
          </tbody>
      </table>

      <script>
        document.addEventListener("DOMContentLoaded", function(){
          fetch('{% url "getMobil" %}')
          .then(response => response.json())
          .then(data => {
            const tbody = document.getElementById("tbodymobil");
            tbody.innerHTML = '';
            let autoIncrement = 1;
            data.forEach(menu =>{
              const row = document.createElement('tr');
              const noCell = document.createElement('td');
              noCell.textContent += autoIncrement;
              row.appendChild(noCell);
              autoIncrement++;

              const merekCell = document.createElement('td');
              merekCell.textContent = menu.merek;
              row.appendChild(merekCell);

              const kapasitasCell = document.createElement('td');
              kapasitasCell.textContent = menu.kapasitas;
              row.appendChild(kapasitasCell);

              const durasiCell = document.createElement('td');
              durasiCell.textContent = menu.durasi;
              row.appendChild(durasiCell);

              const hargaCell = document.createElement('td');
              hargaCell.textContent = menu.harga;
              row.appendChild(hargaCell);

              const actionCell = document.createElement('td');
              actionCell.innerHTML = `
                <button onClick='modalEdit(${menu.merek},"${menu.merek}",${menu.kapasitas}, "${menu.durasi}",${menu.harga})' class="btn btn-xs btn-success">Edit</button>
                <button onClick='modalDelete(${menu.id})' class="btn btn-xs btn-danger">Delete</button>

              `
              row.appendChild(actionCell);
              tbody.appendChild(row);
            });
            $('#mobil').DataTable();
          });
        });
      </script>

      <div id="modalTambah" class="modal">
        <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                <h3 class="modal-title" id="titleModal"></h3>
                <span class="close" style="cursor: pointer;">&times;</span>
              </div>
              <div class="modal-body">
                <form method="POST" action="{% url 'mobil' %}">
                  {% csrf_token %}
                    <div class="mb-1">
                      <input type="hidden" id='id_' name="id" value="">
                      {{ form.as_p }}
                    </div>
                    </div>
                    <div class="modal-footer">
                      <button type="submit" class="btn btn-primary" id="submit_">Submit</button>
                    </div>
                </form>
          </div>
        </div>
      </div>

      <div id="modalHapus" class="modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Delete Mobil</h3>
              <span class="close" style="cursor: pointer;">&times;</span>
            </div>
            <div class="modal-body">
              <p id='text'></p>
            </div>
          </div>
        </div>
      </div>

      <script type="text/javascript">
        function buttonTambah(){
          document.getElementById('id_').value = '';
          document.getElementById('id_merek').value = '';
          document.getElementById('id_kapasitas').value = '';
          document.getElementById('id_durasi').value = ''
          document.getElementById('id_harga').value = '';

          const btnSubmit = document.getElementById('submit_');
          btnSubmit.textContent = "Save";
          btnSubmit.value = "SAVE";

          const btnClose = document.getElementsByClassName('close')[0];
          const modalTambah = document.getElementById('modalTambah');
          modalTambah.style.display = "block";

          const titleModal = document.getElementById('titleModal');
          titleModal.textContent = "Tambah Mobil";
      
          btnClose.onclick = function(){
            modalTambah.style.display = "none";
          }
        }

        function modalEdit(id, merek, kapasitas, durasi, harga){
          document.getElementById('id_').value = id;
          document.getElementById('id_merek').value = merek;
          document.getElementById('id_kapasitas').value = kapasitas;
          document.getElementById('id_durasi').value = durasi;
          document.getElementById('id_harga').value = harga;

          const btnSubmit = document.getElementById('submit_');
          btnSubmit.textContent = "Update";
          btnSubmit.value = "UPDATE";

          const btnClose = document.getElementsByClassName('close')[0];
          const modalEdit = document.getElementById('modalTambah');
          modalEdit.style.display = "block";

          const titleModal = document.getElementById('titleModal');
          titleModal.textContent = "Edit Mobil";

          btnClose.onclick = function(){
            modalEdit.style.display = "none";
          }
        }
      </script>

  </section>

{% include 'admin/components/footer.html' %}